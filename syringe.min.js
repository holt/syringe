// syringe.js v0.3.3. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var m=this,q=function(r){var k={}.hasOwnProperty,n=[].slice,e={},f={},j=[],h=function(a,b){var c;try{var d=/function (.{1,})\(/.exec(a.constructor.toString());c=d&&1<d.length?d[1]:""}catch(g){c=null===a?"Null":"Undefined"}finally{return b?c.toLowerCase():c}},l=function(a,b,c){b=b||this;a=a.split(c||".");return a.filter(function(b){return b.length}).reduce(function(b,a,c,e){if(b)return b[e[c]]},b)},s=function(a,b,c){b=b||this;a=a.split(c||".");var d,g;d=0;for(g=a.length;d<g;d++)c=a[d], b=b[c]=b[c]||{};return b},q=function(a){return a.map(function(b){return l(b,f)},this)},t=function(a,b){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,g=c.createElement("script"),e=!1;g.src=a;g.onload=g.onreadystatechange=function(){if(!e&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState))e=!0,g.onload=g.onreadystatechange=null,d&&g.parentNode&&d.removeChild(g),"function"===h(b,!0)&&b()};d.insertBefore(g,d.firstChild)}else return!1}, p=function(a,b){var c=n.call(arguments),d=j.filter(function(a){return a.fn===b})[0];b=d?d.fn:b;return b.apply(this,q(a).concat(c.slice(2,c.length)))},f=r&&"object"===h(r,!0)?r:f;e.register=e.add=function(a,b,c){if("object"===h(a,!0)){for(var d in a)k.call(a,d)&&this.add.apply(this,[d,a[d]]);return this}if(l(a,f))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!');"function"===h(b,!0)&&c&&(b=this.on(c,b));a=a.split(".");(c=1<a.length?a.pop():!1)?s(a.join("."), f)[c]=b:f[a.toString()]=b;return this};e.unregister=e.remove=function(a){var b={},c={},d=a.trim().split(".");a=d.pop();c=(d=d.join("."))?l(d,f):f;a=a||d;for(var g in c)k.call(c,g)&&!(k.call(c,a)&&g===a)&&(b[g]=c[g]);d?this.set(d,b):f=b;return this};e.bind=e.on=function(){var a=m,b,c,d,g,e,a,f;b=n.call(arguments);c="String"===h(b[0])?!0:!1;switch(b.length){case 2:return f={fn:b[1],ctx:a,bind:p.bind(a,b[0],b[1])},j.push(f),f.bind;case 3:if(c)d=b[0],g=b[1],e=b[2],f={fn:b[2],ctx:a};else return f={fn:b[1], ctx:b[2],bind:p.bind(b[2],b[0],b[1])},j.push(f),f.bind;break;case 4:d=b[0],g=b[1],e=b[2],a=b[3],f={fn:b[2],ctx:b[3]}}b=d.split(".");c=1<b.length?b.pop():!1;f.bind=e=p.bind(a,g,e);j.push(f);c?s(b.join("."),a)[c]=e:a[b.join(".")]=e;return this};e.exec=function(a,b,c){c=c||this;b="array"===h(b,!0)?b:[b];var d=this.get(a);return"string"===h(a,!0)&&"function"===h(d,!0)?d.apply(c,b):!1};e.get=function(a){return"string"===h(a,!0)?(a=l(a,f),"undefined"!==h(a,!0)?a:!1):f};e.set=function(a,b){var c=a.split("."), d=1<c.length?c.pop():!1;if("undefined"===h(l(a,f),!0))throw Error('Key "'+a+'" does not exist in the map!');d?s(c.join("."),f)[d]=b:f[c.toString()]=b;return this};e.fetch=function(a,b){var c=this,d=0,g=function(){var g=++d,e=0,f;for(f in a)k.call(a,f)&&e++;if(g===e){for(var h in a)k.call(a,h)&&a[h].bind&&c.add(h,l(a[h].bind,m));b.call(c)}},e;for(e in a)k.call(a,e)&&t(a[e].path,g)};e.wrap=function(a,b,c){c=c||this;var d=j.filter(function(b){return b.bind===a})[0];return d?function(){var a=n.call(arguments); return b.apply(c,[function(){a=arguments.length?arguments:a;return d.bind.apply(c,a)}].concat(a))}:!1};e.copy=function(a,b,c){c=c||this;var d=n.call(arguments),e=j.filter(function(a){return a.bind===b})[0];return e?(d={fn:b,ctx:d[0],bind:p.bind(e.ctx,a,e.fn)},j.push(d),d.bind):!1};e.VERSION="0.3.3";return e};m.Syringe=q();m.Syringe.create=q}).call(this);
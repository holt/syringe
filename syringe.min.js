// syringe.js v0.4.19. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var t=this,g={},u={}.hasOwnProperty,q=[].slice,n=function(a,b,d){b=b||this;return a.split(d||".").filter(function(c){return c.length}).reduce(function(c,a,b,d){if(c)return c[d[b]]},b)},s=function(a,b,d){b=b||this;return a.split(d||".").reduce(function(c,a){return c[a]?c[a]:c[a]={}},b)},v=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})},k=function(a,b){var d="Undefined";a?d={}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]: null===a?d="Null":!1===a?d="Boolean":"string"===typeof a?d="String":0===a?d="Number":isNaN(a)&&"number"===typeof a&&(d="NaN");return"string"===typeof b?b.toLowerCase()===d.toLowerCase():d},w=function(a,b){var d=g[b].registry;return a.map(function(a){switch(a){case "":break;case "*":return d;case "this":return this;default:return n(a,d,g[b].sep)}},this)},x=function(a,b){var d;"undefined"!==typeof XMLHttpRequest?d=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0", "Microsoft.XmlHttp"].forEach(function(a){try{d=new window.ActiveXObject(a)}catch(b){}});d.onreadystatechange=function(){4>d.readyState||(200!==d.status?b(null):4===d.readyState&&b(d))};d.open("GET",a,!0);d.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.send("")},y=function(a,b,d){b=b||{};b.success=b.success||!1;b.xss=b.xss||!1;var c=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&& c.add(a[e].bind,f);++e===a.length&&k(b.success,"function")&&b.success.call(c,d||c)};a.forEach(function(a){var c=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===c.substring(0,4)?d.test(c):1)||!0===b.xss)&&x(a.path,f)})},p=function(a,b,d){var c=q.call(arguments),e;c.splice(2,1);b=(e=g[d.id].cabinet.filter(function(a){return a.fn===b})[0])?e.fn:b;e=w.apply(d,[a,d.id]).concat(c.slice(2,c.length));return Object.keys(b.prototype).length?(c=Object.create(b.prototype),e=b.apply(c,e),"object"===typeof e? e:c):b.apply(this,e)},r=function(a){g[this.id=v()]={cabinet:[],registry:a&&k(a,"object")?a:{},separator:"."}},h=r.prototype={separator:function(a){var b=1===a.replace(/[?a-zA-Z\d]|\s/g,"").length;return k(a,"string")&&b?(g[this.id].separator=a,this):!1},add:function(a,b,d){var c=g[this.id].registry,e=g[this.id].separator;if(k(a,"object"))return Object.keys(a).forEach(function(b){this.add.apply(this,[b,a[b]])},this),this;if(n(a,c,e))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!'); k(b,"function")&&d&&(b=this.on(d,b));d=a.split(e);var f=1<d.length?d.pop():!1;f?s(d.join(e),c,e)[f]=b:c[d.toString()]=b;return this},remove:function(a){var b=g[this.id].registry,d=g[this.id].separator,c=a.trim().split(d),e=c.pop(),f={},k={},k=(c=c.join(d))?n(c,b,d):b;a=e||c;Object.keys(k).forEach(function(b){b!==a&&(f[b]=k[b])});c?this.set(c,f):g[this.id].registry=f;return this},on:function(){var a=t,b=g[this.id].cabinet,d=g[this.id].separator,c=q.call(arguments),e=k(c[0],"String")?!0:!1,f,h,l,a, m;switch(c.length){case 2:return m={fn:c[1],ctx:a,bind:p.bind(a,c[0],c[1],this),args:c},b.push(m),m.bind;case 3:if(e)f=c[0],h=c[1],l=c[2],m={fn:l,ctx:a,args:c};else return m={fn:c[1],ctx:c[2],args:c,bind:p.bind(c[2],c[0],c[1],this)},b.push(m),m.bind;break;case 4:f=c[0],h=c[1],l=c[2],a=c[3],m={fn:l,ctx:a,args:c}}c=f.split(d);e=1<c.length?c.pop():!1;m.bind=l=p.bind(a,h,l,this);b.push(m);e?s(c.join(d),a,d)[e]=l:a[c.join(d)]=l;return this},exec:function(a,b,d){d=d||this;var c=this.get(a),e=g[this.id].cabinet.filter(function(a){return a.bind=== c})[0];b=k(b,"array")?b:[b];return k(a,"string")&&k(c,"function")?e?(c=e?e.fn:c,p.apply(d,[e.args[0],c,this].concat(b))):c.apply(d,b):!1},get:function(a){var b=g[this.id].registry;return k(a,"string")?(a=n(a,b,g[this.id].separator),k(a,"undefined")?!1:a):b},set:function(a,b,d){var c=g[this.id].registry,e=g[this.id].separator,f=a.split(e),h=1<f.length?f.pop():!1,l;if(void 0===n(a,c,e))if(l=n(f.join(e),c,e),h){if(l&&!u.call(l,h)||!l)throw Error('Key "'+a+'" does not exist in the map!');}else if(!u.call(c, f.toString()))throw Error('Key "'+a+'" does not exist in the map!');k(b,"function")&&d&&(b=this.on(d,b));h?s(f.join(e),c,e)[h]=b:c[f.toString()]=b;return this},wrap:function(a,b,d){d=d||this;var c=g[this.id].cabinet.filter(function(b){return b.bind===a})[0];return c?function(){var a=q.call(arguments);return b.apply(d,[function(){a=arguments.length?arguments:a;return c.bind.apply(d,a)}].concat(a))}:!1},copy:function(a,b,d){d=d||this;var c=g[this.id].cabinet,e=c.filter(function(a){return a.bind===b})[0]; return e?(e={fn:b,ctx:q.call(arguments)[0],bind:p.bind(e.ctx,a,e.fn,this)},c.push(e),e.bind):!1},create:function(a){return new r(a)}};h.mixin=function(a){return k(a,"object")?(Object.keys(a).forEach(function(b){k(a[b],"function")&&(h[b]=a[b])}),this):!1};h.bind=h.on;h.register=h.add;h.unregister=h.remove;h.VERSION="0.4.19";"undefined"!==typeof module&&module.exports?exports=module.exports=new r:(h.fetch=y,t.Syringe=new r)}).call(this);
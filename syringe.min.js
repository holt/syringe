// syringe.js v0.4.21. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var n=this,h={},q={}.hasOwnProperty,m=[].slice,f={getObj:function(b,c,d){return b.split(d||".").filter(function(a){return a.length}).reduce(function(a,b,c,d){if(a)return a[d[c]]},c||this)},setObj:function(b,c,d){return b.split(d||".").reduce(function(a,b){return a[b]?a[b]:a[b]={}},c||this)},sbind:function(){var b=m.call(arguments),c=this;return function(){return c.apply(this,b.concat(m.call(arguments)))}},makeId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c= 16*Math.random()|0;return("x"===b?c:c&3|8).toString(16)})},getType:function(b,c){var d="Undefined";b?d={}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?d="Null":!1===b?d="Boolean":"string"===typeof b?d="String":0===b?d="Number":isNaN(b)&&"number"===typeof b&&(d="NaN");return"string"===typeof c?c.toLowerCase()===d.toLowerCase():d},matchArgs:function(b,c){c=c||[];b=[].slice.call(b);return c.length?c.length===b.length?b.reduce(function(b,a,e){return!b&&f.getType(c[e],"string")?!1:f.getType(a, c[e])},!0):!1:b.map(function(b){return f.getType(b)})},getReg:function(b,c){var d=h[c].registry;return b.map(function(a){switch(a){case "":break;case "*":return d;case "this":return this;default:return f.getObj(a,d,h[c].sep)}},this)},getData:function(b,c){var d;f.getType(XMLHttpRequest,"undefined")?["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{d=new window.ActiveXObject(a)}catch(b){}}):d=new XMLHttpRequest;d.onreadystatechange= function(){4>d.readyState||(200!==d.status?c(null):4===d.readyState&&c(d))};d.open("GET",b,!0);d.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.send("")},fetch:function(b,c,d){c=c||{};c.success=c.success||!1;c.xss=c.xss||!1;var a=this,e=0,g=function(g){g&&g.responseText&&(g=JSON.parse(g.responseText))&&a.add(b[e].bind,g);++e===b.length&&f.getType(c.success,"function")&&c.success.call(a,d||a)};b.forEach(function(a){var b= a.path,d=RegExp("//"+location.host+"($|/)");(("http"===b.substring(0,4)?d.test(b):1)||!0===c.xss)&&f.getData(a.path,g)})},run:function(b,c,d){var a=m.call(arguments),e;a.splice(2,1);c=(e=h[d.id].cabinet.filter(function(a){return a.fn===c})[0])?e.fn:c;e=f.getReg.apply(d,[b,d.id]).concat(a.slice(2,a.length));return Object.keys(c.prototype).length?(a=Object.create(c.prototype),e=c.apply(a,e),f.getType(e,"object")?e:a):c.apply(this,e)}},p=function(b){h[this.id=f.makeId()]={cabinet:[],registry:b&&f.getType(b, "object")?b:{},separator:"."}},l=p.prototype={separator:function(b){return f.getType(b,"string")&&1===b.replace(/[?a-zA-Z\d]|\s/g,"").length?(h[this.id].separator=b,this):!1},add:function(b,c,d){var a=h[this.id].registry,e=h[this.id].separator;if(f.getType(b,"object"))return Object.keys(b).forEach(function(a){this.add.apply(this,[a,b[a]])},this),this;if(f.getObj(b,a,e))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');f.getType(c,"function")&&d&&(c=this.on(d, c));d=b.split(e);var g=1<d.length?d.pop():!1;g?f.setObj(d.join(e),a,e)[g]=c:a[d.toString()]=c;return this},remove:function(b){var c=h[this.id].registry,d=h[this.id].separator,a=b.trim().split(d),e=a.pop(),g={},k={},k=(a=a.join(d))?f.getObj(a,c,d):c;b=e||a;Object.keys(k).forEach(function(a){a!==b&&(g[a]=k[a])});a?this.set(a,g):h[this.id].registry=g;return this},on:function(){var b=n,c=h[this.id].cabinet,d=h[this.id].separator,a=m.call(arguments),e,g,k,b;if(f.matchArgs(a,["array","function"]))return a= {fn:a[1],ctx:b,bind:f.sbind.call(f.run,a[0],a[1],this),args:a},c.push(a),a.bind;if(f.matchArgs(a,["array","function","object"]))return a={fn:a[1],ctx:a[2],args:a,bind:f.run.bind(a[2],a[0],a[1],this)},c.push(a),a.bind;if(f.matchArgs(a,["string","array","function"]))e=a[0],g=a[1],k=a[2],a={fn:k,ctx:b,args:a},a.bind=k=f.sbind.call(f.run,g,k,this);else if(f.matchArgs(a,["string","array","function","object"]))e=a[0],g=a[1],k=a[2],b=a[3],a={fn:k,ctx:b,args:a},a.bind=k=f.run.bind(b,g,k,this);else return this; g=e.split(d);a=1<g.length?g.pop():!1;c.push(a);a?f.setObj(g.join(d),n,d)[a]=k:n[g.join(d)]=k;return this},exec:function(b,c,d){d=d||this;var a=this.get(b),e=h[this.id].cabinet.filter(function(b){return b.bind===a})[0];c=f.getType(c,"array")?c:[c];return f.getType(b,"string")&&f.getType(a,"function")?e?(a=e?e.fn:a,f.run.apply(d,[e.args[0],a,this].concat(c))):a.apply(d,c):!1},get:function(b){var c=h[this.id].registry;return f.getType(b,"string")?(b=f.getObj(b,c,h[this.id].separator),f.getType(b,"undefined")? !1:b):c},set:function(b,c,d){var a=h[this.id].registry,e=h[this.id].separator,g=b.split(e),k=1<g.length?g.pop():!1,l;if(void 0===f.getObj(b,a,e))if(l=f.getObj(g.join(e),a,e),k){if(l&&!q.call(l,k)||!l)throw Error('Key "'+b+'" does not exist in the map!');}else if(!q.call(a,g.toString()))throw Error('Key "'+b+'" does not exist in the map!');f.getType(c,"function")&&d&&(c=this.on(d,c));k?f.setObj(g.join(e),a,e)[k]=c:a[g.toString()]=c;return this},wrap:function(b,c,d){d=d||this;var a=h[this.id].cabinet.filter(function(a){return a.bind=== b})[0];return a?function(){var b=m.call(arguments);return c.apply(d,[function(){b=arguments.length?arguments:b;return a.bind.apply(d,b)}].concat(b))}:!1},copy:function(b,c,d){d=d||this;var a=h[this.id].cabinet,e=a.filter(function(a){return a.bind===c})[0];return e?(e={fn:c,ctx:m.call(arguments)[0],bind:f.run.bind(e.ctx,b,e.fn,this)},a.push(e),e.bind):!1},create:function(b){return new p(b)}};l.mixin=function(b){return f.getType(b,"object")?(Object.keys(b).forEach(function(c){f.getType(b[c],"function")&& (l[c]=b[c])}),this):!1};l.bind=l.on;l.register=l.add;l.unregister=l.remove;l.VERSION="0.4.21";this.window===this?(l.fetch=f.fetch,n.Syringe=new p):"undefined"!==typeof module&&module.exports&&(exports=module.exports=new p)}).call(this);
// syringe.js v0.4.18. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var u=this,h={},n={}.hasOwnProperty,r=[].slice,p=function(a,b,c){b=b||this;return a.split(c||".").filter(function(a){return a.length}).reduce(function(a,b,c,m){if(a)return a[m[c]]},b)},t=function(a,b,c){b=b||this;return a.split(c||".").reduce(function(a,b){return a[b]?a[b]:a[b]={}},b)},w=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})},k=function(a,b){var c="Undefined";a?c={}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]: null===a?c="Null":!1===a?c="Boolean":"string"===typeof a?c="String":0===a?c="Number":isNaN(a)&&"number"===typeof a&&(c="NaN");return"string"===typeof b?b.toLowerCase()===c.toLowerCase():c},v=function(a,b){var c=h[b].registry;return a.map(function(a){switch(a){case "":break;case "*":return c;case "this":return this;default:return p(a,c,h[b].sep)}},this)},x=function(a,b){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0", "Microsoft.XmlHttp"].forEach(function(a){try{c=new window.ActiveXObject(a)}catch(b){}});c.onreadystatechange=function(){4>c.readyState||(200!==c.status?b(null):4===c.readyState&&b(c))};c.open("GET",a,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")},y=function(a,b,c){b=b||{};b.success=b.success||!1;b.xss=b.xss||!1;var d=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&& d.add(a[e].bind,f);++e===a.length&&k(b.success,"function")&&b.success.call(d,c||d)};a.forEach(function(a){var c=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===c.substring(0,4)?d.test(c):1)||!0===b.xss)&&x(a.path,f)})},z=function(a){for(var b in a)if(n.call(a,b))return!1;return!0},q=function(a,b,c){var d=r.call(arguments);d.splice(2,1);var e=h[c.id].cabinet.filter(function(a){return a.fn===b})[0];b=e?e.fn:b;return z(b.prototype)?b.apply(this,v.apply(c,[a,c.id]).concat(d.slice(2,d.length))): new (b.bind.apply(b,[null].concat(v.apply(c,[a,c.id]).concat(d.slice(2,d.length)))))},s=function(a){h[this.id=w()]={cabinet:[],registry:a&&k(a,"object")?a:{},separator:"."}},g=s.prototype={separator:function(a){var b=1===a.replace(/[?a-zA-Z\d]|\s/g,"").length;return k(a,"string")&&b?(h[this.id].separator=a,this):!1},add:function(a,b,c){var d=h[this.id].registry,e=h[this.id].separator;if(k(a,"object")){for(var f in a)n.call(a,f)&&this.add.apply(this,[f,a[f]]);return this}if(p(a,d,e))throw Error('Key "'+ a+'" already exists in the map; use .remove() to unregister it first!');k(b,"function")&&c&&(b=this.on(c,b));a=a.split(e);(c=1<a.length?a.pop():!1)?t(a.join(e),d,e)[c]=b:d[a.toString()]=b;return this},remove:function(a){var b=h[this.id].registry,c=h[this.id].separator,d=a.trim().split(c);a=d.pop();var e={},f={},f=(d=d.join(c))?p(d,b,c):b;a=a||d;for(var m in f)!n.call(f,m)||n.call(f,a)&&m===a||(e[m]=f[m]);d?this.set(d,e):h[this.id].registry=e;return this},on:function(){var a=u,b=h[this.id].cabinet, c=h[this.id].separator,d=r.call(arguments),e=k(d[0],"String")?!0:!1,f,m,l,a,g;switch(d.length){case 2:return g={fn:d[1],ctx:a,bind:q.bind(a,d[0],d[1],this),args:d},b.push(g),g.bind;case 3:if(e)f=d[0],m=d[1],l=d[2],g={fn:l,ctx:a,args:d};else return g={fn:d[1],ctx:d[2],args:d,bind:q.bind(d[2],d[0],d[1],this)},b.push(g),g.bind;break;case 4:f=d[0],m=d[1],l=d[2],a=d[3],g={fn:l,ctx:a,args:d}}d=f.split(c);e=1<d.length?d.pop():!1;g.bind=l=q.bind(a,m,l,this);b.push(g);e?t(d.join(c),a,c)[e]=l:a[d.join(c)]= l;return this},exec:function(a,b,c){c=c||this;var d=this.get(a),e=h[this.id].cabinet.filter(function(a){return a.bind===d})[0];b=k(b,"array")?b:[b];return k(a,"string")&&k(d,"function")?e?(d=e?e.fn:d,q.apply(c,[e.args[0],d,this].concat(b))):d.apply(c,b):!1},get:function(a){var b=h[this.id].registry;return k(a,"string")?(a=p(a,b,h[this.id].separator),k(a,"undefined")?!1:a):b},set:function(a,b,c){var d=h[this.id].registry,e=h[this.id].separator,f=a.split(e),g=1<f.length?f.pop():!1,l;if(void 0===p(a, d,e))if(l=p(f.join(e),d,e),g){if(l&&!n.call(l,g)||!l)throw Error('Key "'+a+'" does not exist in the map!');}else if(!n.call(d,f.toString()))throw Error('Key "'+a+'" does not exist in the map!');k(b,"function")&&c&&(b=this.on(c,b));g?t(f.join(e),d,e)[g]=b:d[f.toString()]=b;return this},wrap:function(a,b,c){c=c||this;var d=h[this.id].cabinet.filter(function(b){return b.bind===a})[0];return d?function(){var a=r.call(arguments);return b.apply(c,[function(){a=arguments.length?arguments:a;return d.bind.apply(c, a)}].concat(a))}:!1},copy:function(a,b,c){c=c||this;var d=h[this.id].cabinet,e=d.filter(function(a){return a.bind===b})[0];return e?(e={fn:b,ctx:r.call(arguments)[0],bind:q.bind(e.ctx,a,e.fn,this)},d.push(e),e.bind):!1},create:function(a){return new s(a)}};g.mixin=function(a){if(k(a,"object")){for(var b in a)n.call(a,b)&&k(a[b],"function")&&(g[b]=a[b]);return this}return!1};g.bind=g.on;g.register=g.add;g.unregister=g.remove;g.VERSION="0.4.18";"undefined"!==typeof module&&module.exports?exports=module.exports= new s:(g.fetch=y,u.Syringe=new s)}).call(this);
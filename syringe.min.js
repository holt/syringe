// syringe.js v0.4.15. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var u=this,h={},q={}.hasOwnProperty,r=[].slice,w=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})},k=function(a,b){var c;c=a?{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]:null===a?"Null":"Undefined";return"string"===typeof b?(b=b.toLowerCase(),c=c.toLowerCase(),b===c):c},n=function(a,b,c){b=b||this;a=a.split(c||".");return a.filter(function(a){return a.length}).reduce(function(a,b,c,l){if(a)return a[l[c]]}, b)},t=function(a,b,c){b=b||this;a=a.split(c||".");var d,e;d=0;for(e=a.length;d<e;d++)c=a[d],b=b[c]=b[c]||{};return b},v=function(a,b){var c=h[b].registry;return a.map(function(a){return""===a?void 0:"*"===a?c:"this"===a?this:n(a,c,h[b].separator)},this)},x=function(a,b){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{c=new window.ActiveXObject(a)}catch(b){}}); c.onreadystatechange=function(){4>c.readyState||(200!==c.status?b(null):4===c.readyState&&b(c))};c.open("GET",a,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")},y=function(a,b,c){b=b||{};b.success=b.success||!1;b.xss=b.xss||!1;var d=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&d.add(a[e].bind,f);++e===a.length&&k(b.success,"function")&&b.success.call(d,c|| d)};a.forEach(function(a){var c=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===c.substring(0,4)?d.test(c):1)||!0===b.xss)&&x(a.path,f)})},z=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},p=function(a,b,c){var d=h[c.id].cabinet,e=r.call(arguments);e.splice(2,1);b=(d=d.filter(function(a){return a.fn===b})[0])?d.fn:b;return z(b.prototype)?b.apply(this,v.apply(c,[a,c.id]).concat(e.slice(2,e.length))):new (b.bind.apply(b,[null].concat(v.apply(c,[a,c.id]).concat(e.slice(2, e.length)))))},s=function(a){h[this.id=w()]={cabinet:[],registry:a&&k(a,"object")?a:{},separator:"."}},g=s.prototype={separator:function(a){return k(a,"string")&&1===a.replace(/[?a-zA-Z\d]|\s/g,"").length?(h[this.id].separator=a,this):!1},add:function(a,b,c){var d=h[this.id].registry,e=h[this.id].separator;if(k(a,"object")){for(var f in a)q.call(a,f)&&this.add.apply(this,[f,a[f]]);return this}if(n(a,d,e))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!');k(b, "function")&&c&&(b=this.on(c,b));a=a.split(e);(c=1<a.length?a.pop():!1)?t(a.join(e),d,e)[c]=b:d[a.toString()]=b;return this},remove:function(a){var b=h[this.id].registry,c=h[this.id].separator,d={},e={},f=a.trim().split(c);a=f.pop();e=(f=f.join(c))?n(f,b,c):b;a=a||f;for(var l in e)!q.call(e,l)||q.call(e,a)&&l===a||(d[l]=e[l]);f?this.set(f,d):h[this.id].registry=d;return this},on:function(){var a=u,b=h[this.id].cabinet,c=h[this.id].separator,d=r.call(arguments),e=k(d[0],"String")?!0:!1,f,l,g,a,m;switch(d.length){case 2:return m= {fn:d[1],ctx:a,bind:p.bind(a,d[0],d[1],this),args:d},b.push(m),m.bind;case 3:if(e)f=d[0],l=d[1],g=d[2],m={fn:g,ctx:a,args:d};else return m={fn:d[1],ctx:d[2],args:d,bind:p.bind(d[2],d[0],d[1],this)},b.push(m),m.bind;break;case 4:f=d[0],l=d[1],g=d[2],a=d[3],m={fn:g,ctx:a,args:d}}d=f.split(c);e=1<d.length?d.pop():!1;m.bind=g=p.bind(a,l,g,this);b.push(m);e?t(d.join(c),a,c)[e]=g:a[d.join(c)]=g;return this},exec:function(a,b,c){c=c||this;var d=h[this.id].cabinet,e=this.get(a),d=d.filter(function(a){return a.bind=== e})[0];b=k(b,"array")?b:[b];return k(a,"string")&&k(e,"function")?d?(e=d?d.fn:e,p.apply(c,[d.args[0],e,this].concat(b))):e.apply(c,b):!1},get:function(a){var b=h[this.id].registry;return k(a,"string")?(a=n(a,b,h[this.id].separator),k(a,"undefined")?!1:a):b},set:function(a,b,c){var d=h[this.id].registry,e=h[this.id].separator,f=a.split(e),g=1<f.length?f.pop():!1;if(void 0===n(a,d,e))throw Error('Key "'+a+'" does not exist in the map!');k(b,"function")&&c&&(b=this.on(c,b));g?t(f.join(e),d,e)[g]=b:d[f.toString()]= b;return this},wrap:function(a,b,c){var d=h[this.id].cabinet;c=c||this;var e=d.filter(function(b){return b.bind===a})[0];return e?function(){var a=r.call(arguments);return b.apply(c,[function(){a=arguments.length?arguments:a;return e.bind.apply(c,a)}].concat(a))}:!1},copy:function(a,b,c){c=c||this;var d=h[this.id].cabinet,e=r.call(arguments),f=d.filter(function(a){return a.bind===b})[0];return f?(e={fn:b,ctx:e[0],bind:p.bind(f.ctx,a,f.fn,this)},d.push(e),e.bind):!1},create:function(a){return new s(a)}}; g.mixin=function(a){if(k(a,"object")){for(var b in a)q.call(a,b)&&k(a[b],"function")&&(g[b]=a[b]);return this}return!1};g.bind=g.on;g.register=g.add;g.unregister=g.remove;g.VERSION="0.4.15";"undefined"!==typeof module&&module.exports?exports=module.exports=new s:(g.fetch=y,u.Syringe=new s)}).call(this);
// syringe.js v0.4.20. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var q=this,h={},u={}.hasOwnProperty,r=[].slice,n=function(b,c,d){c=c||this;return b.split(d||".").filter(function(a){return a.length}).reduce(function(a,c,b,d){if(a)return a[d[b]]},c)},t=function(b,c,d){c=c||this;return b.split(d||".").reduce(function(a,c){return a[c]?a[c]:a[c]={}},c)},v=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0;return("x"===b?c:c&3|8).toString(16)})},k=function(b,c){var d="Undefined";b?d={}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]: null===b?d="Null":!1===b?d="Boolean":"string"===typeof b?d="String":0===b?d="Number":isNaN(b)&&"number"===typeof b&&(d="NaN");return"string"===typeof c?c.toLowerCase()===d.toLowerCase():d},w=function(b,c){var d=h[c].registry;return b.map(function(a){switch(a){case "":break;case "*":return d;case "this":return this;default:return n(a,d,h[c].sep)}},this)},x=function(b,c){var d;k(XMLHttpRequest,"undefined")?["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(c){try{d= new window.ActiveXObject(c)}catch(b){}}):d=new XMLHttpRequest;d.onreadystatechange=function(){4>d.readyState||(200!==d.status?c(null):4===d.readyState&&c(d))};d.open("GET",b,!0);d.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.send("")},y=function(b,c,d){c=c||{};c.success=c.success||!1;c.xss=c.xss||!1;var a=this,e=0,g=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&a.add(b[e].bind,f); ++e===b.length&&k(c.success,"function")&&c.success.call(a,d||a)};b.forEach(function(a){var b=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===b.substring(0,4)?d.test(b):1)||!0===c.xss)&&x(a.path,g)})},p=function(b,c,d){var a=r.call(arguments),e;a.splice(2,1);c=(e=h[d.id].cabinet.filter(function(a){return a.fn===c})[0])?e.fn:c;e=w.apply(d,[b,d.id]).concat(a.slice(2,a.length));return Object.keys(c.prototype).length?(a=Object.create(c.prototype),e=c.apply(a,e),k(e,"object")?e:a):c.apply(this,e)}, s=function(b){h[this.id=v()]={cabinet:[],registry:b&&k(b,"object")?b:{},separator:"."}},m=s.prototype={separator:function(b){var c=1===b.replace(/[?a-zA-Z\d]|\s/g,"").length;return k(b,"string")&&c?(h[this.id].separator=b,this):!1},add:function(b,c,d){var a=h[this.id].registry,e=h[this.id].separator;if(k(b,"object"))return Object.keys(b).forEach(function(a){this.add.apply(this,[a,b[a]])},this),this;if(n(b,a,e))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!'); k(c,"function")&&d&&(c=this.on(d,c));d=b.split(e);var g=1<d.length?d.pop():!1;g?t(d.join(e),a,e)[g]=c:a[d.toString()]=c;return this},remove:function(b){var c=h[this.id].registry,d=h[this.id].separator,a=b.trim().split(d),e=a.pop(),g={},f={},f=(a=a.join(d))?n(a,c,d):c;b=e||a;Object.keys(f).forEach(function(a){a!==b&&(g[a]=f[a])});a?this.set(a,g):h[this.id].registry=g;return this},on:function(){var b=q,c=h[this.id].cabinet,d=h[this.id].separator,a=r.call(arguments),e=k(a[0],"String")?!0:!1,g,f,b,l, m=function(){var a=[].slice,c=a.call(arguments),b=this;return function(){return b.apply(this,c.concat(a.call(arguments)))}};switch(a.length){case 2:return l={fn:a[1],ctx:b,bind:m.call(p,a[0],a[1],this),args:a},c.push(l),l.bind;case 3:if(e)g=a[0],e=a[1],f=a[2],l={fn:f,ctx:b,args:a},l.bind=f=m.call(p,e,f,this);else return l={fn:a[1],ctx:a[2],args:a,bind:p.bind(a[2],a[0],a[1],this)},c.push(l),l.bind;break;case 4:g=a[0],e=a[1],f=a[2],b=a[3],l={fn:f,ctx:b,args:a},l.bind=f=p.bind(b,e,f,this)}a=g.split(d); g=1<a.length?a.pop():!1;c.push(l);g?t(a.join(d),q,d)[g]=f:q[a.join(d)]=f;return this},exec:function(b,c,d){d=d||this;var a=this.get(b),e=h[this.id].cabinet.filter(function(c){return c.bind===a})[0];c=k(c,"array")?c:[c];return k(b,"string")&&k(a,"function")?e?(a=e?e.fn:a,p.apply(d,[e.args[0],a,this].concat(c))):a.apply(d,c):!1},get:function(b){var c=h[this.id].registry;return k(b,"string")?(b=n(b,c,h[this.id].separator),k(b,"undefined")?!1:b):c},set:function(b,c,d){var a=h[this.id].registry,e=h[this.id].separator, g=b.split(e),f=1<g.length?g.pop():!1,l;if(void 0===n(b,a,e))if(l=n(g.join(e),a,e),f){if(l&&!u.call(l,f)||!l)throw Error('Key "'+b+'" does not exist in the map!');}else if(!u.call(a,g.toString()))throw Error('Key "'+b+'" does not exist in the map!');k(c,"function")&&d&&(c=this.on(d,c));f?t(g.join(e),a,e)[f]=c:a[g.toString()]=c;return this},wrap:function(b,c,d){d=d||this;var a=h[this.id].cabinet.filter(function(a){return a.bind===b})[0];return a?function(){var b=r.call(arguments);return c.apply(d,[function(){b= arguments.length?arguments:b;return a.bind.apply(d,b)}].concat(b))}:!1},copy:function(b,c,d){d=d||this;var a=h[this.id].cabinet,e=a.filter(function(a){return a.bind===c})[0];return e?(e={fn:c,ctx:r.call(arguments)[0],bind:p.bind(e.ctx,b,e.fn,this)},a.push(e),e.bind):!1},create:function(b){return new s(b)}};m.mixin=function(b){return k(b,"object")?(Object.keys(b).forEach(function(c){k(b[c],"function")&&(m[c]=b[c])}),this):!1};m.bind=m.on;m.register=m.add;m.unregister=m.remove;m.VERSION="0.4.20";this.window=== this?(m.fetch=y,q.Syringe=new s):"undefined"!==typeof module&&module.exports&&(exports=module.exports=new s)}).call(this);
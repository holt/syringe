// syringe.js v0.3.4. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var m=this,q=function(r){var k={}.hasOwnProperty,n=[].slice,g={},e={},j=[],h=function(b,a){var c;try{var d=/function (.{1,})\(/.exec(b.constructor.toString());c=d&&1<d.length?d[1]:""}catch(f){c=null===b?"Null":"Undefined"}finally{return a?c.toLowerCase():c}},l=function(b,a,c){a=a||this;b=b.split(c||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,g){if(a)return a[g[c]]},a)},s=function(b,a,c){a=a||this;b=b.split(c||".");var d,f;d=0;for(f=b.length;d<f;d++)c=b[d], a=a[c]=a[c]||{};return a},q=function(b){return b.map(function(a){return l(a,e)},this)},u=function(b,a){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,f=c.createElement("script"),t=!1;f.src=b;f.onload=f.onreadystatechange=function(){if(!t&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState))t=!0,f.onload=f.onreadystatechange=null,d&&f.parentNode&&d.removeChild(f),"function"===h(a,!0)&&a()};d.insertBefore(f,d.firstChild)}else return!1}, p=function(b,a){var c=n.call(arguments),d=j.filter(function(b){return b.fn===a})[0];a=d?d.fn:a;for(var f in a.prototype)this.constructor.prototype[f]=a.prototype[f];return a.apply(this,q(b).concat(c.slice(2,c.length)))},e=r&&"object"===h(r,!0)?r:e;g.register=g.add=function(b,a,c){if("object"===h(b,!0)){for(var d in b)k.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(l(b,e))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===h(a,!0)&&c&& (a=this.on(c,a));b=b.split(".");(c=1<b.length?b.pop():!1)?s(b.join("."),e)[c]=a:e[b.toString()]=a;return this};g.unregister=g.remove=function(b){var a={},c={},d=b.trim().split(".");b=d.pop();c=(d=d.join("."))?l(d,e):e;b=b||d;for(var f in c)k.call(c,f)&&!(k.call(c,b)&&f===b)&&(a[f]=c[f]);d?this.set(d,a):e=a;return this};g.bind=g.on=function(){var b=m,a,c,d,f,g,b,e;a=n.call(arguments);c="String"===h(a[0])?!0:!1;switch(a.length){case 2:return e={fn:a[1],ctx:b,bind:p.bind(b,a[0],a[1])},j.push(e),e.bind; case 3:if(c)d=a[0],f=a[1],g=a[2],e={fn:a[2],ctx:b};else return e={fn:a[1],ctx:a[2],bind:p.bind(a[2],a[0],a[1])},j.push(e),e.bind;break;case 4:d=a[0],f=a[1],g=a[2],b=a[3],e={fn:a[2],ctx:a[3]}}a=d.split(".");c=1<a.length?a.pop():!1;e.bind=g=p.bind(b,f,g);j.push(e);c?s(a.join("."),b)[c]=g:b[a.join(".")]=g;return this};g.exec=function(b,a,c){c=c||this;a="array"===h(a,!0)?a:[a];var d=this.get(b);return"string"===h(b,!0)&&"function"===h(d,!0)?d.apply(c,a):!1};g.get=function(b){return"string"===h(b,!0)? (b=l(b,e),"undefined"!==h(b,!0)?b:!1):e};g.set=function(b,a){var c=b.split("."),d=1<c.length?c.pop():!1;if("undefined"===h(l(b,e),!0))throw Error('Key "'+b+'" does not exist in the map!');d?s(c.join("."),e)[d]=a:e[c.toString()]=a;return this};g.fetch=function(b,a){var c=this,d=0,f=function(){var f=++d,e=0,g;for(g in b)k.call(b,g)&&e++;if(f===e){for(var h in b)k.call(b,h)&&b[h].bind&&c.add(h,l(b[h].bind,m));a.call(c)}},e;for(e in b)k.call(b,e)&&u(b[e].path,f)};g.wrap=function(b,a,c){c=c||this;var d= j.filter(function(a){return a.bind===b})[0];return d?function(){var b=n.call(arguments);return a.apply(c,[function(){b=arguments.length?arguments:b;return d.bind.apply(c,b)}].concat(b))}:!1};g.copy=function(b,a,c){c=c||this;var d=n.call(arguments),e=j.filter(function(b){return b.bind===a})[0];return e?(d={fn:a,ctx:d[0],bind:p.bind(e.ctx,b,e.fn)},j.push(d),d.bind):!1};g.VERSION="0.3.4";return g};m.Syringe=q();m.Syringe.create=q}).call(this);
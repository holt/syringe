// syringe.js v0.4.11. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var v=this,l={},n={},t={}.hasOwnProperty,r=[].slice,x=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0;return("x"===b?c:c&3|8).toString(16)})},h=function(b,c){var a;a=b?{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?"Null":"Undefined";return!0===c?a.toLowerCase():a},p=function(b,c,a){c=c||this;b=b.split(a||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,f){if(a)return a[f[c]]},c)},u=function(b, c,a){c=c||this;b=b.split(a||".");var e,d;e=0;for(d=b.length;e<d;e++)a=b[e],c=c[a]=c[a]||{};return c},w=function(b,c){var a=l[c];return b.map(function(b){return""===b?void 0:"*"===b?a:p(b,a)},this)},y=function(b,c){var a;"undefined"!==typeof XMLHttpRequest?a=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(b){try{a=new window.ActiveXObject(b)}catch(c){}});a.onreadystatechange=function(){4>a.readyState||(200!== a.status?c(null):4===a.readyState&&c(a))};a.open("GET",b,!0);a.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");a.setRequestHeader("Content-Type","application/json; charset=utf-8");a.send("")},z=function(b){for(var c in b)if(b.hasOwnProperty(c))return!1;return!0},q=function(b,c,a){var e=n[a],d=r.call(arguments);d.splice(2,1);c=(e=e.filter(function(a){return a.fn===c})[0])?e.fn:c;return z(c.prototype)?c.apply(this,w(b,a).concat(d.slice(2,d.length))):new (c.bind.apply(c,[null].concat(w(b, a).concat(d.slice(2,d.length)))))},s=function(b){this.id=x();l[this.id]={};n[this.id]=[];l[this.id]=b&&"object"===h(b,!0)?b:l[this.id]},m=s.prototype={add:function(b,c,a){var e=l[this.id];if("object"===h(b,!0)){for(var d in b)t.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(p(b,e))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===h(c,!0)&&a&&(c=this.on(a,c));b=b.split(".");(a=1<b.length?b.pop():!1)?u(b.join("."),e)[a]=c:e[b.toString()]= c;return this},remove:function(b){var c=l[this.id],a={},e={},d=b.trim().split(".");b=d.pop();e=(d=d.join("."))?p(d,c):c;b=b||d;for(var g in e)!t.call(e,g)||t.call(e,b)&&g===b||(a[g]=e[g]);d?this.set(d,a):l[this.id]=a;return this},on:function(){var b=v,c=n[this.id],a=r.call(arguments),e="String"===h(a[0])?!0:!1,d,g,f,b,k;switch(a.length){case 2:return k={fn:a[1],ctx:b,bind:q.bind(b,a[0],a[1],this.id),args:a},c.push(k),k.bind;case 3:if(e)d=a[0],g=a[1],f=a[2],k={fn:f,ctx:b,args:a};else return k={fn:a[1], ctx:a[2],args:a,bind:q.bind(a[2],a[0],a[1],this.id)},c.push(k),k.bind;break;case 4:d=a[0],g=a[1],f=a[2],b=a[3],k={fn:f,ctx:b,args:a}}a=d.split(".");e=1<a.length?a.pop():!1;k.bind=f=q.bind(b,g,f,this.id);c.push(k);e?u(a.join("."),b)[e]=f:b[a.join(".")]=f;return this},exec:function(b,c,a){a=a||this;var e=n[this.id],d=this.get(b),e=e.filter(function(a){return a.bind===d})[0];c="array"===h(c,!0)?c:[c];return"string"===h(b,!0)&&"function"===h(d,!0)?e?(d=e?e.fn:d,q.apply(a,[e.args[0],d,this.id].concat(c))): d.apply(a,c):!1},get:function(b){var c=l[this.id];return"string"===h(b,!0)?(b=p(b,c),"undefined"!==h(b,!0)?b:!1):c},set:function(b,c){var a=l[this.id],e=b.split("."),d=1<e.length?e.pop():!1;if(void 0===p(b,a))throw Error('Key "'+b+'" does not exist in the map!');d?u(e.join("."),a)[d]=c:a[e.toString()]=c;return this},wrap:function(b,c,a){var e=n[this.id];a=a||this;var d=e.filter(function(a){return a.bind===b})[0];return d?function(){var b=r.call(arguments);return c.apply(a,[function(){b=arguments.length? arguments:b;return d.bind.apply(a,b)}].concat(b))}:!1},copy:function(b,c,a){a=a||this;var e=n[this.id],d=r.call(arguments),g=e.filter(function(a){return a.bind===c})[0];return g?(d={fn:c,ctx:d[0],bind:q.bind(g.ctx,b,g.fn,this.id)},e.push(d),d.bind):!1},create:function(b){return new s(b)}};m.bind=m.on;m.register=m.add;m.unregister=m.remove;m.VERSION="0.4.11";"undefined"!==typeof module&&module.exports?exports=module.exports=new s:(m.fetch=function(b,c,a){c=c||{};c.success=c.success||!1;c.xss=c.xss|| !1;var e=this,d=0,g=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&e.add(b[d].bind,f);++d===b.length&&"function"===h(c.success,!0)&&c.success.call(e,a||e)};b.forEach(function(a){var b=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===b.substring(0,4)?d.test(b):1)||!0===c.xss)&&y(a.path,g)})},v.Syringe=new s)}).call(this);
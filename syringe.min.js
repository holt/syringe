// syringe.js v0.3.0. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var m=this,p=function(q){var k={}.hasOwnProperty,p=Object.prototype.toString,s=[].slice,e={},f={},j=[],h=function(b,a){var c=p.call(b).slice(8,-1);return a&&c.toLowerCase()||c},l=function(b,a,c){a=a||this;b=b.split(c||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,e){if(a)return a[e[c]]},a)},r=function(b,a,c){a=a||this;b=b.split(c||".");var d,g;d=0;for(g=b.length;d<g;d++)c=b[d],a=a[c]=a[c]||{};return a},t=function(b){return b.map(function(a){return l(a,f)},this)}, u=function(b,a){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,g=c.createElement("script"),e=!1;g.src=b;g.onload=g.onreadystatechange=function(){if(!e&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState))e=!0,g.onload=g.onreadystatechange=null,d&&g.parentNode&&d.removeChild(g),"function"===h(a,!0)&&a()};d.insertBefore(g,d.firstChild)}else return!1},n=function(b,a){var c=s.call(arguments),d=j.filter(function(b){return b.fn=== a})[0];a=d?d.fn:a;return a.apply(this,t(b).concat(c.slice(2,c.length)))},f=q&&"object"===h(q,!0)?q:f;e.register=e.add=function(b,a,c){if("object"===h(b,!0)){for(var d in b)k.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(l(b,f))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===h(a,!0)&&c&&(a=this.on(c,a));b=b.split(".");(c=1<b.length?b.pop():!1)?r(b.join("."),f)[c]=a:f[b.toString()]=a;return this};e.unregister=e.remove=function(b){var a= {},c={},d=b.trim().split(".");b=d.pop();c=(d=d.join("."))?l(d,f):f;b=b||d;for(var g in c)k.call(c,g)&&!(k.call(c,b)&&g===b)&&(a[g]=c[g]);d?this.set(d,a):f=a;return this};e.bind=e.on=function(){var b=m,a,c,d,g,e,b,f;a=[].slice.call(arguments);c="String"===h(a[0])?!0:!1;switch(a.length){case 2:return f={fn:a[1],ctx:b,bind:n.bind(b,a[0],a[1])},j.push(f),f.bind;case 3:if(c)d=a[0],g=a[1],e=a[2],f={fn:a[2],ctx:b};else return f={fn:a[1],ctx:a[2],bind:n.bind(a[2],a[0],a[1])},j.push(f),f.bind;break;case 4:d= a[0],g=a[1],e=a[2],b=a[3],f={fn:a[2],ctx:a[3]}}a=d.split(".");c=1<a.length?a.pop():!1;f.bind=e=n.bind(b,g,e);j.push(f);c?r(a.join("."),b)[c]=e:b[a.join(".")]=e;return this};e.exec=function(b,a,c){c=c||this;a="array"===h(a,!0)?a:[a];var d=this.get(b);return"string"===h(b,!0)&&"function"===h(d,!0)?d.apply(c,a):!1};e.get=function(b){return"string"===h(b,!0)?(b=l(b,f),"undefined"!==h(b,!0)?b:!1):f};e.set=function(b,a){var c=b.split("."),d=1<c.length?c.pop():!1;if("undefined"===h(l(b,f),!0))throw Error('Key "'+ b+'" does not exist in the map!');d?r(c.join("."),f)[d]=a:f[c.toString()]=a;return this};e.fetch=function(b,a){var c=this,d=0,g=function(){var e=++d,g=0,f;for(f in b)k.call(b,f)&&g++;if(e===g){for(var h in b)k.call(b,h)&&b[h].bind&&c.add(h,l(b[h].bind,m));a.call(c)}},e;for(e in b)k.call(b,e)&&u(b[e].path,g)};e.wrap=function(b,a,c){c=c||this;var d=j.filter(function(a){return a.bind===b})[0];return d?function(){var b=[].slice.call(arguments);return a.apply(c,[function(){return d.bind.apply(c,arguments)}].concat(b))}: !1};e.copy=function(b,a,c){c=c||this;var d=[].slice.call(arguments),e=j.filter(function(b){return b.bind===a})[0];return e?(d={fn:a,ctx:d[0],bind:n.bind(e.ctx,b,e.fn)},j.push(d),d.bind):!1};e.VERSION="0.3.0";return e};m.Syringe=p();m.Syringe.create=p}).call(this);
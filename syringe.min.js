// syringe.js v0.3.11. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var q=this,s=function(t){var m={}.hasOwnProperty,p=[].slice,f={},g={},l=[],s=function(b){var a=0,c;for(c in b)m.call(b,c)&&a++;return a},k=function(b,a){var c;c=b?{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?"Null":"Undefined";return a?c.toLowerCase():c},n=function(b,a,c){a=a||this;b=b.split(c||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,h){if(a)return a[h[c]]},a)},u=function(b,a,c){a=a||this;b=b.split(c||".");var d,e;d=0;for(e=b.length;d<e;d++)c= b[d],a=a[c]=a[c]||{};return a},w=function(b){return b.map(function(a){return n(a,g)},this)},v=function(b,a){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,e=c.createElement("script"),j=!1;e.src=b;e.onload=e.onreadystatechange=function(){var b=this.readyState;if(!j&&(!b||"loaded"===b||"complete"===b))j=!0,e.onload=e.onreadystatechange=null,d&&e.parentNode&&d.removeChild(e),"function"===k(a,!0)&&a()};d.insertBefore(e,d.firstChild)}else return!1},x=function(b, a){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{c=new window.ActiveXObject(a)}catch(b){}});c.onreadystatechange=function(){4>c.readyState||200===c.status&&4===c.readyState&&a(c)};c.open("GET",b,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")}, r=function(b,a){var c=p.call(arguments),d=l.filter(function(b){return b.fn===a})[0];a=d?d.fn:a;for(var e in a.prototype)this.constructor.prototype[e]=a.prototype[e];return a.apply(this,w(b).concat(c.slice(2,c.length)))},g=t&&"object"===k(t,!0)?t:g;f.register=f.add=function(b,a,c){if("object"===k(b,!0)){for(var d in b)m.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(n(b,g))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===k(a,!0)&&c&& (a=this.on(c,a));b=b.split(".");(c=1<b.length?b.pop():!1)?u(b.join("."),g)[c]=a:g[b.toString()]=a;return this};f.unregister=f.remove=function(b){var a={},c={},d=b.trim().split(".");b=d.pop();c=(d=d.join("."))?n(d,g):g;b=b||d;for(var e in c)m.call(c,e)&&!(m.call(c,b)&&e===b)&&(a[e]=c[e]);d?this.set(d,a):g=a;return this};f.bind=f.on=function(){var b=q,a,c,d,e,j,b,h;a=p.call(arguments);c="String"===k(a[0])?!0:!1;switch(a.length){case 2:return h={fn:a[1],ctx:b,bind:r.bind(b,a[0],a[1])},l.push(h),h.bind; case 3:if(c)d=a[0],e=a[1],j=a[2],h={fn:a[2],ctx:b};else return h={fn:a[1],ctx:a[2],bind:r.bind(a[2],a[0],a[1])},l.push(h),h.bind;break;case 4:d=a[0],e=a[1],j=a[2],b=a[3],h={fn:a[2],ctx:a[3]}}a=d.split(".");c=1<a.length?a.pop():!1;h.bind=j=r.bind(b,e,j);l.push(h);c?u(a.join("."),b)[c]=j:b[a.join(".")]=j;return this};f.exec=function(b,a,c){c=c||this;a="array"===k(a,!0)?a:[a];var d=this.get(b);return"string"===k(b,!0)&&"function"===k(d,!0)?d.apply(c,a):!1};f.get=function(b){return"string"===k(b,!0)? (b=n(b,g),"undefined"!==k(b,!0)?b:!1):g};f.set=function(b,a){var c=b.split("."),d=1<c.length?c.pop():!1;if(void 0===n(b,g))throw Error('Key "'+b+'" does not exist in the map!');d?u(c.join("."),g)[d]=a:g[c.toString()]=a;return this};f.fetch=function(b,a){a=a||{};a.script=a.script||!1;var c=this,d=0,e,j=function(e){p.call(arguments);if(++d===s(b)){for(var f in b)if(m.call(b,f))if(e&&e.response){var g=eval(e.response);g&&c.add(f,g)}else b[f].bind&&c.add(f,n(b[f].bind,q));"Function"===k(a.success)&&a.success.call(c)}}, h;for(h in b)if(m.call(b,h)){var f=e=b[h].path,g=RegExp("//"+location.host+"($|/)");("http"===f.substring(0,4)?g.test(f):1)?a.script?v(e,j):x(e,j):v(e,j)}return this};f.wrap=function(b,a,c){c=c||this;var d=l.filter(function(a){return a.bind===b})[0];return d?function(){var b=p.call(arguments);return a.apply(c,[function(){b=arguments.length?arguments:b;return d.bind.apply(c,b)}].concat(b))}:!1};f.copy=function(b,a,c){c=c||this;var d=p.call(arguments),e=l.filter(function(b){return b.bind===a})[0];return e? (d={fn:a,ctx:d[0],bind:r.bind(e.ctx,b,e.fn)},l.push(d),d.bind):!1};f.VERSION="0.3.11";return f};q.Syringe=s();q.Syringe.create=s}).call(this);
// syringe.js v0.4.13. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var w=this,n={},p={},m={},u={}.hasOwnProperty,s=[].slice,y=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})},h=function(a,b){var c;c=a?{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]:null===a?"Null":"Undefined";return!0===b?c.toLowerCase():c},q=function(a,b,c){b=b||this;a=a.split(c||".");return a.filter(function(a){return a.length}).reduce(function(a,b,c,k){if(a)return a[k[c]]},b)},v=function(a, b,c){b=b||this;a=a.split(c||".");var d,e;d=0;for(e=a.length;d<e;d++)c=a[d],b=b[c]=b[c]||{};return b},x=function(a,b){var c=n[b];return a.map(function(a){return""===a?void 0:"*"===a?c:q(a,c,m[b])},this)},z=function(a,b){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{c=new window.ActiveXObject(a)}catch(b){}});c.onreadystatechange=function(){4>c.readyState|| (200!==c.status?b(null):4===c.readyState&&b(c))};c.open("GET",a,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")},A=function(a,b,c){b=b||{};b.success=b.success||!1;b.xss=b.xss||!1;var d=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&d.add(a[e].bind,f);++e===a.length&&"function"===h(b.success,!0)&&b.success.call(d,c||d)};a.forEach(function(a){var c=a.path,d=RegExp("//"+ location.host+"($|/)");(("http"===c.substring(0,4)?d.test(c):1)||!0===b.xss)&&z(a.path,f)})},B=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},r=function(a,b,c){var d=p[c],e=s.call(arguments);e.splice(2,1);b=(d=d.filter(function(a){return a.fn===b})[0])?d.fn:b;return B(b.prototype)?b.apply(this,x(a,c).concat(e.slice(2,e.length))):new (b.bind.apply(b,[null].concat(x(a,c).concat(e.slice(2,e.length)))))},t=function(a){this.id=y();p[this.id]=[];n[this.id]=a&&"object"===h(a,!0)?a: {};m[this.id]="."},g=t.prototype={separator:function(a){return"string"===h(a,!0)&&1===a.replace(/[?a-zA-Z\d]|\s/g,"").length?(m[this.id]=a,this):!1},add:function(a,b,c){var d=n[this.id],e=m[this.id];if("object"===h(a,!0)){for(var f in a)u.call(a,f)&&this.add.apply(this,[f,a[f]]);return this}if(q(a,d,e))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!');"function"===h(b,!0)&&c&&(b=this.on(c,b));a=a.split(e);(c=1<a.length?a.pop():!1)?v(a.join(e),d,e)[c]=b:d[a.toString()]= b;return this},remove:function(a){var b=n[this.id],c=m[this.id],d={},e={},f=a.trim().split(c);a=f.pop();e=(f=f.join(c))?q(f,b,c):b;a=a||f;for(var k in e)!u.call(e,k)||u.call(e,a)&&k===a||(d[k]=e[k]);f?this.set(f,d):n[this.id]=d;return this},on:function(){var a=w,b=p[this.id],c=m[this.id],d=s.call(arguments),e="String"===h(d[0])?!0:!1,f,k,g,a,l;switch(d.length){case 2:return l={fn:d[1],ctx:a,bind:r.bind(a,d[0],d[1],this.id),args:d},b.push(l),l.bind;case 3:if(e)f=d[0],k=d[1],g=d[2],l={fn:g,ctx:a,args:d}; else return l={fn:d[1],ctx:d[2],args:d,bind:r.bind(d[2],d[0],d[1],this.id)},b.push(l),l.bind;break;case 4:f=d[0],k=d[1],g=d[2],a=d[3],l={fn:g,ctx:a,args:d}}d=f.split(c);e=1<d.length?d.pop():!1;l.bind=g=r.bind(a,k,g,this.id);b.push(l);e?v(d.join(c),a,c)[e]=g:a[d.join(c)]=g;return this},exec:function(a,b,c){c=c||this;var d=p[this.id],e=this.get(a),d=d.filter(function(a){return a.bind===e})[0];b="array"===h(b,!0)?b:[b];return"string"===h(a,!0)&&"function"===h(e,!0)?d?(e=d?d.fn:e,r.apply(c,[d.args[0], e,this.id].concat(b))):e.apply(c,b):!1},get:function(a){var b=n[this.id];return"string"===h(a,!0)?(a=q(a,b,m[this.id]),"undefined"!==h(a,!0)?a:!1):b},set:function(a,b,c){var d=n[this.id],e=m[this.id],f=a.split(e),g=1<f.length?f.pop():!1;if(void 0===q(a,d,e))throw Error('Key "'+a+'" does not exist in the map!');"function"===h(b,!0)&&c&&(b=this.on(c,b));g?v(f.join(e),d,e)[g]=b:d[f.toString()]=b;return this},wrap:function(a,b,c){var d=p[this.id];c=c||this;var e=d.filter(function(b){return b.bind===a})[0]; return e?function(){var a=s.call(arguments);return b.apply(c,[function(){a=arguments.length?arguments:a;return e.bind.apply(c,a)}].concat(a))}:!1},copy:function(a,b,c){c=c||this;var d=p[this.id],e=s.call(arguments),f=d.filter(function(a){return a.bind===b})[0];return f?(e={fn:b,ctx:e[0],bind:r.bind(f.ctx,a,f.fn,this.id)},d.push(e),e.bind):!1},create:function(a){return new t(a)}};g.bind=g.on;g.register=g.add;g.unregister=g.remove;g.VERSION="0.4.13";"undefined"!==typeof module&&module.exports?exports= module.exports=new t:(g.fetch=A,w.Syringe=new t)}).call(this);
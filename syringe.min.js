// syringe.js v0.3.9. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var p=this,r=function(s){var l={}.hasOwnProperty,n=[].slice,f={},g={},k=[],r=function(b){var a=0,c;for(c in b)l.call(b,c)&&a++;return a},j=function(b,a){var c;c=b?{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?"Null":"Undefined";return a?c.toLowerCase():c},m=function(b,a,c){a=a||this;b=b.split(c||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,h){if(a)return a[h[c]]},a)},t=function(b,a,c){a=a||this;b=b.split(c||".");var d,e;d=0;for(e=b.length;d<e;d++)c= b[d],a=a[c]=a[c]||{};return a},v=function(b){return b.map(function(a){return m(a,g)},this)},w=function(b,a){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,e=c.createElement("script"),u=!1;e.src=b;e.onload=e.onreadystatechange=function(){var b=this.readyState;if(!u&&(!b||"loaded"===b||"complete"===b))u=!0,e.onload=e.onreadystatechange=null,d&&e.parentNode&&d.removeChild(e),"function"===j(a,!0)&&a()};d.insertBefore(e,d.firstChild)}else return!1},x=function(b, a){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{c=new window.ActiveXObject(a)}catch(b){}});c.onreadystatechange=function(){4>c.readyState||200===c.status&&4===c.readyState&&a(c)};c.open("GET",b,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")}, q=function(b,a){var c=n.call(arguments),d=k.filter(function(b){return b.fn===a})[0];a=d?d.fn:a;for(var e in a.prototype)this.constructor.prototype[e]=a.prototype[e];return a.apply(this,v(b).concat(c.slice(2,c.length)))},g=s&&"object"===j(s,!0)?s:g;f.register=f.add=function(b,a,c){if("object"===j(b,!0)){for(var d in b)l.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(m(b,g))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===j(a,!0)&&c&& (a=this.on(c,a));b=b.split(".");(c=1<b.length?b.pop():!1)?t(b.join("."),g)[c]=a:g[b.toString()]=a;return this};f.unregister=f.remove=function(b){var a={},c={},d=b.trim().split(".");b=d.pop();c=(d=d.join("."))?m(d,g):g;b=b||d;for(var e in c)l.call(c,e)&&!(l.call(c,b)&&e===b)&&(a[e]=c[e]);d?this.set(d,a):g=a;return this};f.bind=f.on=function(){var b=p,a,c,d,e,f,b,h;a=n.call(arguments);c="String"===j(a[0])?!0:!1;switch(a.length){case 2:return h={fn:a[1],ctx:b,bind:q.bind(b,a[0],a[1])},k.push(h),h.bind; case 3:if(c)d=a[0],e=a[1],f=a[2],h={fn:a[2],ctx:b};else return h={fn:a[1],ctx:a[2],bind:q.bind(a[2],a[0],a[1])},k.push(h),h.bind;break;case 4:d=a[0],e=a[1],f=a[2],b=a[3],h={fn:a[2],ctx:a[3]}}a=d.split(".");c=1<a.length?a.pop():!1;h.bind=f=q.bind(b,e,f);k.push(h);c?t(a.join("."),b)[c]=f:b[a.join(".")]=f;return this};f.exec=function(b,a,c){c=c||this;a="array"===j(a,!0)?a:[a];var d=this.get(b);return"string"===j(b,!0)&&"function"===j(d,!0)?d.apply(c,a):!1};f.get=function(b){return"string"===j(b,!0)? (b=m(b,g),"undefined"!==j(b,!0)?b:!1):g};f.set=function(b,a){var c=b.split("."),d=1<c.length?c.pop():!1;if(void 0===m(b,g))throw Error('Key "'+b+'" does not exist in the map!');d?t(c.join("."),g)[d]=a:g[c.toString()]=a;return this};f.fetch=function(b,a){a=a||{};var c=this,d=0,e,f=function(e){n.call(arguments);if(++d===r(b)){for(var f in b)if(l.call(b,f))if(e&&e.response){var g=eval(e.response);g&&c.add(f,g)}else b[f].bind&&c.add(f,m(b[f].bind,p));"Function"===j(a.success)&&a.success.call(c)}},h;for(h in b)if(l.call(b, h)){var g=e=b[h].path,k=RegExp("//"+location.host+"($|/)");("http"===g.substring(0,4)?k.test(g):1)?x(e,f):w(e,f)}return this};f.wrap=function(b,a,c){c=c||this;var d=k.filter(function(a){return a.bind===b})[0];return d?function(){var b=n.call(arguments);return a.apply(c,[function(){b=arguments.length?arguments:b;return d.bind.apply(c,b)}].concat(b))}:!1};f.copy=function(b,a,c){c=c||this;var d=n.call(arguments),e=k.filter(function(b){return b.bind===a})[0];return e?(d={fn:a,ctx:d[0],bind:q.bind(e.ctx, b,e.fn)},k.push(d),d.bind):!1};f.VERSION="0.3.9";return f};p.Syringe=r();p.Syringe.create=r}).call(this);
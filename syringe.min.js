// syringe.js v0.4.12. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var v=this,m={},n={},t={}.hasOwnProperty,r=[].slice,x=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"===a?c:c&3|8).toString(16)})},g=function(a,c){var b;b=a?{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]:null===a?"Null":"Undefined";return!0===c?b.toLowerCase():b},p=function(a,c,b){c=c||this;a=a.split(b||".");return a.filter(function(b){return b.length}).reduce(function(b,a,c,h){if(b)return b[h[c]]},c)},u=function(a, c,b){c=c||this;a=a.split(b||".");var e,d;e=0;for(d=a.length;e<d;e++)b=a[e],c=c[b]=c[b]||{};return c},w=function(a,c){var b=m[c];return a.map(function(a){return""===a?void 0:"*"===a?b:p(a,b)},this)},y=function(a,c){var b;"undefined"!==typeof XMLHttpRequest?b=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{b=new window.ActiveXObject(a)}catch(c){}});b.onreadystatechange=function(){4>b.readyState||(200!== b.status?c(null):4===b.readyState&&c(b))};b.open("GET",a,!0);b.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.send("")},z=function(a,c,b){c=c||{};c.success=c.success||!1;c.xss=c.xss||!1;var e=this,d=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&e.add(a[d].bind,f);++d===a.length&&"function"===g(c.success,!0)&&c.success.call(e,b||e)};a.forEach(function(a){var b=a.path,d=RegExp("//"+ location.host+"($|/)");(("http"===b.substring(0,4)?d.test(b):1)||!0===c.xss)&&y(a.path,f)})},A=function(a){for(var c in a)if(a.hasOwnProperty(c))return!1;return!0},q=function(a,c,b){var e=n[b],d=r.call(arguments);d.splice(2,1);c=(e=e.filter(function(a){return a.fn===c})[0])?e.fn:c;return A(c.prototype)?c.apply(this,w(a,b).concat(d.slice(2,d.length))):new (c.bind.apply(c,[null].concat(w(a,b).concat(d.slice(2,d.length)))))},s=function(a){this.id=x();n[this.id]=[];m[this.id]=a&&"object"===g(a,!0)?a: {}},l=s.prototype={add:function(a,c,b){var e=m[this.id];if("object"===g(a,!0)){for(var d in a)t.call(a,d)&&this.add.apply(this,[d,a[d]]);return this}if(p(a,e))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!');"function"===g(c,!0)&&b&&(c=this.on(b,c));a=a.split(".");(b=1<a.length?a.pop():!1)?u(a.join("."),e)[b]=c:e[a.toString()]=c;return this},remove:function(a){var c=m[this.id],b={},e={},d=a.trim().split(".");a=d.pop();e=(d=d.join("."))?p(d,c):c;a=a||d;for(var f in e)!t.call(e, f)||t.call(e,a)&&f===a||(b[f]=e[f]);d?this.set(d,b):m[this.id]=b;return this},on:function(){var a=v,c=n[this.id],b=r.call(arguments),e="String"===g(b[0])?!0:!1,d,f,h,a,k;switch(b.length){case 2:return k={fn:b[1],ctx:a,bind:q.bind(a,b[0],b[1],this.id),args:b},c.push(k),k.bind;case 3:if(e)d=b[0],f=b[1],h=b[2],k={fn:h,ctx:a,args:b};else return k={fn:b[1],ctx:b[2],args:b,bind:q.bind(b[2],b[0],b[1],this.id)},c.push(k),k.bind;break;case 4:d=b[0],f=b[1],h=b[2],a=b[3],k={fn:h,ctx:a,args:b}}b=d.split("."); e=1<b.length?b.pop():!1;k.bind=h=q.bind(a,f,h,this.id);c.push(k);e?u(b.join("."),a)[e]=h:a[b.join(".")]=h;return this},exec:function(a,c,b){b=b||this;var e=n[this.id],d=this.get(a),e=e.filter(function(a){return a.bind===d})[0];c="array"===g(c,!0)?c:[c];return"string"===g(a,!0)&&"function"===g(d,!0)?e?(d=e?e.fn:d,q.apply(b,[e.args[0],d,this.id].concat(c))):d.apply(b,c):!1},get:function(a){var c=m[this.id];return"string"===g(a,!0)?(a=p(a,c),"undefined"!==g(a,!0)?a:!1):c},set:function(a,c,b){var e=m[this.id], d=a.split("."),f=1<d.length?d.pop():!1;if(void 0===p(a,e))throw Error('Key "'+a+'" does not exist in the map!');"function"===g(c,!0)&&b&&(c=this.on(b,c));f?u(d.join("."),e)[f]=c:e[d.toString()]=c;return this},wrap:function(a,c,b){var e=n[this.id];b=b||this;var d=e.filter(function(b){return b.bind===a})[0];return d?function(){var a=r.call(arguments);return c.apply(b,[function(){a=arguments.length?arguments:a;return d.bind.apply(b,a)}].concat(a))}:!1},copy:function(a,c,b){b=b||this;var e=n[this.id], d=r.call(arguments),f=e.filter(function(a){return a.bind===c})[0];return f?(d={fn:c,ctx:d[0],bind:q.bind(f.ctx,a,f.fn,this.id)},e.push(d),d.bind):!1},create:function(a){return new s(a)}};l.bind=l.on;l.register=l.add;l.unregister=l.remove;l.VERSION="0.4.12";"undefined"!==typeof module&&module.exports?exports=module.exports=new s:(l.fetch=z,v.Syringe=new s)}).call(this);
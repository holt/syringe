// syringe.js v0.4.7. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var t=this,k={},n={},u={}.hasOwnProperty,r=[].slice,w=function(){var b=0;return function(){return"s"+ ++b}}.call(t),g=function(b,c){var a;a=b?{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?"Null":"Undefined";return!0===c?a.toLowerCase():a},p=function(b,c,a){c=c||this;b=b.split(a||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,l){if(a)return a[l[c]]},c)},v=function(b,c,a){c=c||this;b=b.split(a||".");var d,e;d=0;for(e=b.length;d<e;d++)a=b[d],c=c[a]=c[a]|| {};return c},x=function(b,c){var a=k[c];return b.map(function(b){return p(b,a)},this)},q=function(b,c,a){var d=n[a],e=r.call(arguments);e.splice(2,1);c=(d=d.filter(function(a){return a.fn===c})[0])?d.fn:c;for(var f in c.prototype)this.constructor.prototype[f]=c.prototype[f];return c.apply(this,x(b,a).concat(e.slice(2,e.length)))},s=function(b){this.id=w();k[this.id]={};n[this.id]=[];k[this.id]=b&&"object"===g(b,!0)?b:k[this.id]},m=s.prototype={add:function(b,c,a){var d=k[this.id];if("object"===g(b, !0)){for(var e in b)u.call(b,e)&&this.add.apply(this,[e,b[e]]);return this}if(p(b,d))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===g(c,!0)&&a&&(c=this.on(a,c));b=b.split(".");(a=1<b.length?b.pop():!1)?v(b.join("."),d)[a]=c:d[b.toString()]=c;return this},remove:function(b){var c=k[this.id],a={},d={},e=b.trim().split(".");b=e.pop();d=(e=e.join("."))?p(e,c):c;b=b||e;for(var f in d)!u.call(d,f)||u.call(d,b)&&f===b||(a[f]=d[f]);e?this.set(e,a): k[this.id]=a;return this},on:function(){var b=t,c=n[this.id],a=r.call(arguments),d="String"===g(a[0])?!0:!1,e,f,l,b,h;switch(a.length){case 2:return h={fn:a[1],ctx:b,bind:q.bind(b,a[0],a[1],this.id),args:a},c.push(h),h.bind;case 3:if(d)e=a[0],f=a[1],l=a[2],h={fn:a[2],ctx:b,args:a};else return h={fn:a[1],ctx:a[2],args:a,bind:q.bind(a[2],a[0],a[1],this.id)},c.push(h),h.bind;break;case 4:e=a[0],f=a[1],l=a[2],b=a[3],h={fn:a[2],ctx:a[3],args:a}}a=e.split(".");d=1<a.length?a.pop():!1;h.bind=l=q.bind(b, f,l,this.id);c.push(h);d?v(a.join("."),b)[d]=l:b[a.join(".")]=l;return this},exec:function(b,c,a){a=a||this;var d=n[this.id],e=this.get(b),d=d.filter(function(a){return a.bind===e})[0];c="array"===g(c,!0)?c:[c];return"string"===g(b,!0)&&"function"===g(e,!0)?d?(e=d?d.fn:e,q.apply(a,[d.args[0],e,this.id].concat(c))):e.apply(a,c):!1},get:function(b){var c=k[this.id];return"string"===g(b,!0)?(b=p(b,c),"undefined"!==g(b,!0)?b:!1):c},set:function(b,c){var a=k[this.id],d=b.split("."),e=1<d.length?d.pop(): !1;if(void 0===p(b,a))throw Error('Key "'+b+'" does not exist in the map!');e?v(d.join("."),a)[e]=c:a[d.toString()]=c;return this},wrap:function(b,c,a){var d=n[this.id];a=a||this;var e=d.filter(function(a){return a.bind===b})[0];return e?function(){var b=r.call(arguments);return c.apply(a,[function(){b=arguments.length?arguments:b;return e.bind.apply(a,b)}].concat(b))}:!1},copy:function(b,c,a){a=a||this;var d=n[this.id],e=r.call(arguments),f=d.filter(function(a){return a.bind===c})[0];return f?(e= {fn:c,ctx:e[0],bind:q.bind(f.ctx,b,f.fn,this.id)},d.push(e),e.bind):!1},create:function(b){return new s(b)}};m.bind=m.on;m.register=m.add;m.unregister=m.remove;m.VERSION="0.4.7";if("undefined"!==typeof module&&module.exports)exports=module.exports=new s;else{var y=function(b,c){var a;"undefined"!==typeof XMLHttpRequest?a=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(b){try{a=new window.ActiveXObject(b)}catch(c){}}); a.onreadystatechange=function(){4>a.readyState||(200!==a.status?c(null):4===a.readyState&&c(a))};a.open("GET",b,!0);a.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");a.setRequestHeader("Content-Type","application/json; charset=utf-8");a.send("")};m.fetch=function(b,c,a){c.success=c.success||!1;var d=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&d.add(b[e].bind,f);++e===b.length&&"function"===g(c.success,!0)&&c.success.call(d,a||d)};b.forEach(function(a){var b= a.path,c=RegExp("//"+location.host+"($|/)");("http"===b.substring(0,4)?c.test(b):1)&&y(a.path,f)})};t.Syringe=new s}}).call(this);
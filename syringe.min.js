// syringe.js v0.4.16. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var q=this,h={},p={}.hasOwnProperty,s=[].slice,w=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})},k=function(a,b){var c;c=a?{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]:!0===a||!1===a?"Boolean":null===a?"Null":"Undefined";return"string"===typeof b?b.toLowerCase()===c.toLowerCase():c},n=function(a,b,c){b=b||this;a=a.split(c||".");return a.filter(function(a){return a.length}).reduce(function(a, b,c,m){if(a)return a[m[c]]},b)},t=function(a,b,c){b=b||this;a=a.split(c||".");var d,e;d=0;for(e=a.length;d<e;d++)c=a[d],b=b[c]=b[c]||{};return b},v=function(a,b){var c=h[b].reg;return a.map(function(a){switch(a){case "":break;case "*":return c;case "this":return this;default:return n(a,c,h[b].sep)}},this)},x=function(a,b){var c;"undefined"!==typeof XMLHttpRequest?c=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(a){try{c= new window.ActiveXObject(a)}catch(b){}});c.onreadystatechange=function(){4>c.readyState||(200!==c.status?b(null):4===c.readyState&&b(c))};c.open("GET",a,!0);c.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.send("")},y=function(a,b,c){b=b||{};b.success=b.success||!1;b.xss=b.xss||!1;var d=this,e=0,f=function(f){f&&f.responseText&&(f=JSON.parse(f.responseText))&&d.add(a[e].bind,f);++e===a.length&&k(b.success, "function")&&b.success.call(d,c||d)};a.forEach(function(a){var c=a.path,d=RegExp("//"+location.host+"($|/)");(("http"===c.substring(0,4)?d.test(c):1)||!0===b.xss)&&x(a.path,f)})},z=function(a){for(var b in a)if(p.call(a,b))return!1;return!0},r=function(a,b,c){var d=h[c.id].cab,e=n(a.join(h[c.id].sep),h[c.id].events),f=s.call(arguments);f.splice(2,1);b=(d=d.filter(function(a){return a.fn===b})[0])?d.fn:b;b=z(b.prototype)?b.apply(this,v.apply(c,[a,c.id]).concat(f.slice(2,f.length))):new (b.bind.apply(b, [null].concat(v.apply(c,[a,c.id]).concat(f.slice(2,f.length)))));e&&e(b);return b},u=function(a){h[this.id=w()]={cab:[],evt:{},reg:a&&k(a,"object")?a:{},sep:"."};this.events.on=this.events.on.bind(this)},g=u.prototype={separator:function(a){var b=1===a.replace(/[?a-zA-Z\d]|\s/g,"").length;return k(a,"string")&&b?(h[this.id].sep=a,this):!1},add:function(a,b,c){var d=h[this.id].reg,e=h[this.id].sep;if(k(a,"object")){for(var f in a)p.call(a,f)&&this.add.apply(this,[f,a[f]]);return this}if(n(a,d,e))throw Error('Key "'+ a+'" already exists in the map; use .remove() to unregister it first!');k(b,"function")&&c&&(b=this.on(c,b));a=a.split(e);(c=1<a.length?a.pop():!1)?t(a.join(e),d,e)[c]=b:d[a.toString()]=b;return this},remove:function(a){var b=h[this.id].reg,c=h[this.id].sep,d=a.trim().split(c);a=d.pop();var e={},f={},f=(d=d.join(c))?n(d,b,c):b;a=a||d;for(var m in f)!p.call(f,m)||p.call(f,a)&&m===a||(e[m]=f[m]);d?this.set(d,e):h[this.id].reg=e;return this},on:function(){var a=q,b=h[this.id].cab,c=h[this.id].sep,d= s.call(arguments),e=k(d[0],"String")?!0:!1,f,m,l,a,g;switch(d.length){case 2:return g={fn:d[1],ctx:a,bind:r.bind(a,d[0],d[1],this),args:d},b.push(g),g.bind;case 3:if(e)f=d[0],m=d[1],l=d[2],g={fn:l,ctx:a,args:d};else return g={fn:d[1],ctx:d[2],args:d,bind:r.bind(d[2],d[0],d[1],this)},b.push(g),g.bind;break;case 4:f=d[0],m=d[1],l=d[2],a=d[3],g={fn:l,ctx:a,args:d}}d=f.split(c);e=1<d.length?d.pop():!1;g.bind=l=r.bind(a,m,l,this);b.push(g);e?t(d.join(c),a,c)[e]=l:a[d.join(c)]=l;return this},exec:function(a, b,c){c=c||this;var d=h[this.id].cab,e=this.get(a),d=d.filter(function(a){return a.bind===e})[0];b=k(b,"array")?b:[b];return k(a,"string")&&k(e,"function")?d?(e=d?d.fn:e,r.apply(c,[d.args[0],e,this].concat(b))):e.apply(c,b):!1},get:function(a){var b=h[this.id].reg,c=h[this.id].sep;return k(a,"string")?(a=n(a,b,c),k(a,"undefined")?!1:a):b},set:function(a,b,c){var d=h[this.id].reg,e=h[this.id].sep,f=a.split(e),g=1<f.length?f.pop():!1,l;if(void 0===n(a,d,e))if(l=n(f.join(e),d,e),g){if(l&&!p.call(l,g)|| !l)throw Error('Key "'+a+'" does not exist in the map!');}else if(!p.call(d,f.toString()))throw Error('Key "'+a+'" does not exist in the map!');k(b,"function")&&c&&(b=this.on(c,b));g?t(f.join(e),d,e)[g]=b:d[f.toString()]=b;return this},wrap:function(a,b,c){var d=h[this.id].cab;c=c||this;var e=d.filter(function(b){return b.bind===a})[0];return e?function(){var a=s.call(arguments);return b.apply(c,[function(){a=arguments.length?arguments:a;return e.bind.apply(c,a)}].concat(a))}:!1},copy:function(a, b,c){c=c||this;var d=h[this.id].cab,e=s.call(arguments),f=d.filter(function(a){return a.bind===b})[0];return f?(e={fn:b,ctx:e[0],bind:r.bind(f.ctx,a,f.fn,this)},d.push(e),e.bind):!1},create:function(a){return new u(a)},events:{on:function(a,b,c){c=c||this;var d=h[this.id].evt,e=h[this.id].sep,f=a.split(e),g=1<f.length?f.pop():!1;if(void 0===n(a,h[this.id].reg,e))throw Error('Key "'+a+'" does not exist in the map!');g?t(f.join(e),d,e)[g]=b.bind(c):d[f.toString()]=b.bind(c);return this}}};g.mixin=function(a){if(k(a, "object")){for(var b in a)p.call(a,b)&&k(a[b],"function")&&(g[b]=a[b]);return this}return!1};g.bind=g.on;g.register=g.add;g.unregister=g.remove;g.VERSION="0.4.16";"undefined"!==typeof q.module&&q.module.exports?q.exports=q.module.exports=new u:(g.fetch=y,q.Syringe=new u)}).call(this);
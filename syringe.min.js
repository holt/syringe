// syringe.js v0.3.7. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var n=this,r=function(s){var l={}.hasOwnProperty,p=[].slice,e={},g={},k=[],j=function(a,b){var c;c=a?{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1]:null===a?"Null":"Undefined";return b?c.toLowerCase():c},m=function(a,b,c){b=b||this;a=a.split(c||".");return a.filter(function(b){return b.length}).reduce(function(b,a,c,u){if(b)return b[u[c]]},b)},t=function(a,b,c){b=b||this;a=a.split(c||".");var d,f;d=0;for(f=a.length;d<f;d++)c=a[d],b=b[c]=b[c]||{};return b},r=function(a){return a.map(function(b){return m(b, g)},this)},v=function(a,b){var c=window?window.document:!1;if(c){var d=c.getElementsByTagName("head")[0]||c.documentElement,f=c.createElement("script"),h=!1;f.src=a;f.onload=f.onreadystatechange=function(){var a=this.readyState;if(!h&&(!a||"loaded"===a||"complete"===a))h=!0,f.onload=f.onreadystatechange=null,d&&f.parentNode&&d.removeChild(f),"function"===j(b,!0)&&b()};d.insertBefore(f,d.firstChild)}else return!1},q=function(a,b){var c=p.call(arguments),d=k.filter(function(a){return a.fn===b})[0]; b=d?d.fn:b;for(var f in b.prototype)this.constructor.prototype[f]=b.prototype[f];return b.apply(this,r(a).concat(c.slice(2,c.length)))},g=s&&"object"===j(s,!0)?s:g;e.register=e.add=function(a,b,c){if("object"===j(a,!0)){for(var d in a)l.call(a,d)&&this.add.apply(this,[d,a[d]]);return this}if(m(a,g))throw Error('Key "'+a+'" already exists in the map; use .remove() to unregister it first!');"function"===j(b,!0)&&c&&(b=this.on(c,b));a=a.split(".");(c=1<a.length?a.pop():!1)?t(a.join("."),g)[c]=b:g[a.toString()]= b;return this};e.unregister=e.remove=function(a){var b={},c={},d=a.trim().split(".");a=d.pop();c=(d=d.join("."))?m(d,g):g;a=a||d;for(var f in c)l.call(c,f)&&!(l.call(c,a)&&f===a)&&(b[f]=c[f]);d?this.set(d,b):g=b;return this};e.bind=e.on=function(){var a=n,b,c,d,f,h,a,e;b=p.call(arguments);c="String"===j(b[0])?!0:!1;switch(b.length){case 2:return e={fn:b[1],ctx:a,bind:q.bind(a,b[0],b[1])},k.push(e),e.bind;case 3:if(c)d=b[0],f=b[1],h=b[2],e={fn:b[2],ctx:a};else return e={fn:b[1],ctx:b[2],bind:q.bind(b[2], b[0],b[1])},k.push(e),e.bind;break;case 4:d=b[0],f=b[1],h=b[2],a=b[3],e={fn:b[2],ctx:b[3]}}b=d.split(".");c=1<b.length?b.pop():!1;e.bind=h=q.bind(a,f,h);k.push(e);c?t(b.join("."),a)[c]=h:a[b.join(".")]=h;return this};e.exec=function(a,b,c){c=c||this;b="array"===j(b,!0)?b:[b];var d=this.get(a);return"string"===j(a,!0)&&"function"===j(d,!0)?d.apply(c,b):!1};e.get=function(a){return"string"===j(a,!0)?(a=m(a,g),"undefined"!==j(a,!0)?a:!1):g};e.set=function(a,b){var c=a.split("."),d=1<c.length?c.pop(): !1;if(void 0===m(a,g))throw Error('Key "'+a+'" does not exist in the map!');d?t(c.join("."),g)[d]=b:g[c.toString()]=b;return this};e.fetch=function(a,b){var c=this,d=0,f=function(){var f=++d,e=0,g;for(g in a)l.call(a,g)&&e++;if(f===e){for(var h in a)l.call(a,h)&&a[h].bind&&c.add(h,m(a[h].bind,n));"Function"===j(b)&&b.call(c)}},e;for(e in a)l.call(a,e)&&v(a[e].path,f)};e.wrap=function(a,b,c){c=c||this;var d=k.filter(function(b){return b.bind===a})[0];return d?function(){var a=p.call(arguments);return b.apply(c, [function(){a=arguments.length?arguments:a;return d.bind.apply(c,a)}].concat(a))}:!1};e.copy=function(a,b,c){c=c||this;var d=p.call(arguments),e=k.filter(function(a){return a.bind===b})[0];return e?(d={fn:b,ctx:d[0],bind:q.bind(e.ctx,a,e.fn)},k.push(d),d.bind):!1};e.VERSION="0.3.7";return e};n.Syringe=r();n.Syringe.create=r}).call(this);
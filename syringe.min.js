// syringe.js v0.2.9. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var m=this,p=function(q){var k={}.hasOwnProperty,p=Object.prototype.toString,s=[].slice,d={},f={},j=[],h=function(b,a){var c=p.call(b).slice(8,-1);return a&&c.toLowerCase()||c},l=function(b,a,c){a=a||this;b=b.split(c||".");return b.filter(function(a){return a.length}).reduce(function(a,b,c,f){if(a)return a[f[c]]},a)},r=function(b,a,c){a=a||this;b=b.split(c||".");var e,g;e=0;for(g=b.length;e<g;e++)c=b[e],a=a[c]=a[c]||{};return a},t=function(b){return b.map(function(a){return l(a,f)},this)}, u=function(b,a){var c=window?window.document:!1;if(c){var e=c.getElementsByTagName("head")[0]||c.documentElement,g=c.createElement("script"),f=!1;g.src=b;g.onload=g.onreadystatechange=function(){if(!f&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState))f=!0,g.onload=g.onreadystatechange=null,e&&g.parentNode&&e.removeChild(g),"function"===h(a,!0)&&a()};e.insertBefore(g,e.firstChild)}else return!1},n=function(b,a){var c=s.call(arguments),e=j.filter(function(b){return b.fn=== a})[0];a=e?e.fn:a;return a.apply(this,t(b).concat(c.slice(2,c.length)))},f=q&&"object"===h(q,!0)?q:f;d.register=d.add=function(b,a,c){if("object"===h(b,!0)){for(var e in b)k.call(b,e)&&this.add.apply(this,[e,b[e]]);return this}if(l(b,f))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===h(a,!0)&&c&&(a=this.on(c,a));b=b.split(".");(c=1<b.length?b.pop():!1)?r(b.join("."),f)[c]=a:f[b.toString()]=a;return this};d.unregister=d.remove=function(b){var a= {},c;for(c in f)k.call(f,c)&&!(k.call(f,b)&&c===b)&&(a[c]=f[c]);f=a;return this};d.bind=d.on=function(){var b=m,a,c,e,g,f,b,d;a=[].slice.call(arguments);c="String"===h(a[0])?!0:!1;switch(a.length){case 2:return d={fn:a[1],ctx:b,bind:n.bind(b,a[0],a[1])},j.push(d),d.bind;case 3:if(c)e=a[0],g=a[1],f=a[2],d={fn:a[2],ctx:b};else return d={fn:a[1],ctx:a[2],bind:n.bind(a[2],a[0],a[1])},j.push(d),d.bind;break;case 4:e=a[0],g=a[1],f=a[2],b=a[3],d={fn:a[2],ctx:a[3]}}a=e.split(".");c=1<a.length?a.pop():!1; d.bind=f=n.bind(b,g,f);j.push(d);c?r(a.join("."),b)[c]=f:b[a.join(".")]=f;return this};d.exec=function(b,a,c){c=c||this;a="array"===h(a,!0)?a:[a];var e=this.get(b);return"string"===h(b,!0)&&"function"===h(e,!0)?e.apply(c,a):!1};d.get=function(b){return"string"===h(b,!0)?(b=l(b,f),"undefined"!==h(b,!0)?b:!1):f};d.set=function(b,a){var c=b.split("."),e=1<c.length?c.pop():!1;if("undefined"===h(l(b,f),!0))throw Error('Key "'+b+'" does not exist in the map!');e?r(c.join("."),f)[e]=a:f[c.toString()]=a; return this};d.fetch=function(b,a){var c=this,e=0,f=function(){var f=++e,d=0,g;for(g in b)k.call(b,g)&&d++;if(f===d){for(var h in b)k.call(b,h)&&b[h].bind&&c.add(h,l(b[h].bind,m));a.call(c)}},d;for(d in b)k.call(b,d)&&u(b[d].path,f)};d.wrap=function(b,a,c){c=c||this;var e=j.filter(function(a){return a.bind===b})[0];return e?function(){var b=[].slice.call(arguments);return a.apply(c,[function(){return e.bind.apply(c,b)}].concat(b))}:!1};d.copy=function(b,a,c){c=c||this;var e=[].slice.call(arguments), d=j.filter(function(b){return b.bind===a})[0];return d?(e={fn:a,ctx:e[0],bind:n.bind(d.ctx,b,d.fn)},j.push(e),e.bind):!1};d.VERSION="0.2.9";return d};m.Syringe=p();m.Syringe.create=p}).call(this);
// syringe.js v0.4.2. Copyright (c) 2013 Michael Holt, holt.org. Distributed under the MIT License
(function(){var r=this,l={},q={},n={}.hasOwnProperty,s=[].slice,x=function(){var b=0;return function(){return"s"+ ++b}}.call(r),y=function(b){var c=RegExp("//"+location.host+"($|/)");return"http"===b.substring(0,4)?c.test(b):!0},z=function(b){var c=0,a;for(a in b)n.call(b,a)&&c++;return c},h=function(b,c){var a;a=b?{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1]:null===b?"Null":"Undefined";return!0===c?a.toLowerCase():a},p=function(b,c,a){c=c||this;b=b.split(a||".");return b.filter(function(a){return a.length}).reduce(function(a, b,c,g){if(a)return a[g[c]]},c)},v=function(b,c,a){c=c||this;b=b.split(a||".");var e,d;e=0;for(d=b.length;e<d;e++)a=b[e],c=c[a]=c[a]||{};return c},A=function(b,c){var a=l[c];return b.map(function(b){return p(b,a)},this)},t=function(b,c,a){var e=q[a],d=s.call(arguments);d.splice(2,1);c=(e=e.filter(function(a){return a.fn===c})[0])?e.fn:c;for(var f in c.prototype)this.constructor.prototype[f]=c.prototype[f];return c.apply(this,A(b,a).concat(d.slice(2,d.length)))},u=function(b){this.id=x();l[this.id]= {};q[this.id]=[];l[this.id]=b&&"object"===h(b,!0)?b:l[this.id]},m=u.prototype={add:function(b,c,a){var e=l[this.id];if("object"===h(b,!0)){for(var d in b)n.call(b,d)&&this.add.apply(this,[d,b[d]]);return this}if(p(b,e))throw Error('Key "'+b+'" already exists in the map; use .remove() to unregister it first!');"function"===h(c,!0)&&a&&(c=this.on(a,c));b=b.split(".");(a=1<b.length?b.pop():!1)?v(b.join("."),e)[a]=c:e[b.toString()]=c;return this},remove:function(b){var c=l[this.id],a={},e={},d=b.trim().split("."); b=d.pop();e=(d=d.join("."))?p(d,c):c;b=b||d;for(var f in e)!n.call(e,f)||n.call(e,b)&&f===b||(a[f]=e[f]);d?this.set(d,a):l[this.id]=a;return this},on:function(){var b=r,c=q[this.id],a=s.call(arguments),e="String"===h(a[0])?!0:!1,d,f,g,b,k;switch(a.length){case 2:return k={fn:a[1],ctx:b,bind:t.bind(b,a[0],a[1],this.id)},c.push(k),k.bind;case 3:if(e)d=a[0],f=a[1],g=a[2],k={fn:a[2],ctx:b};else return k={fn:a[1],ctx:a[2],bind:t.bind(a[2],a[0],a[1],this.id)},c.push(k),k.bind;break;case 4:d=a[0],f=a[1], g=a[2],b=a[3],k={fn:a[2],ctx:a[3]}}a=d.split(".");e=1<a.length?a.pop():!1;k.bind=g=t.bind(b,f,g,this.id);c.push(k);e?v(a.join("."),b)[e]=g:b[a.join(".")]=g;return this},exec:function(b,c,a){a=a||this;c="array"===h(c,!0)?c:[c];var e=this.get(b);return"string"===h(b,!0)&&"function"===h(e,!0)?e.apply(a,c):!1},get:function(b){var c=l[this.id];return"string"===h(b,!0)?(b=p(b,c),"undefined"!==h(b,!0)?b:!1):c},set:function(b,c){var a=l[this.id],e=b.split("."),d=1<e.length?e.pop():!1;if(void 0===p(b,a))throw Error('Key "'+ b+'" does not exist in the map!');d?v(e.join("."),a)[d]=c:a[e.toString()]=c;return this},wrap:function(b,c,a){var e=q[this.id];a=a||this;var d=e.filter(function(a){return a.bind===b})[0];return d?function(){var b=s.call(arguments);return c.apply(a,[function(){b=arguments.length?arguments:b;return d.bind.apply(a,b)}].concat(b))}:!1},copy:function(b,c,a){a=a||this;var e=q[this.id],d=s.call(arguments),f=e.filter(function(a){return a.bind===c})[0];return f?(d={fn:c,ctx:d[0],bind:t.bind(f.ctx,b,f.fn,this.id)}, e.push(d),d.bind):!1},create:function(b){return new u(b)}};m.bind=m.on;m.register=m.add;m.unregister=m.remove;m.VERSION="0.4.2";if("undefined"!==typeof module&&module.exports)exports=module.exports=new u;else{var w=function(b,c){var a=window?window.document:!1;if(a){var e=a.getElementsByTagName("head")[0]||a.documentElement,d=a.createElement("script"),f=!1;d.src=b;d.onload=d.onreadystatechange=function(){var a=this.readyState;f||a&&"loaded"!==a&&"complete"!==a||(f=!0,d.onload=d.onreadystatechange= null,e&&d.parentNode&&e.removeChild(d),"function"===h(c,!0)&&c())};e.insertBefore(d,e.firstChild)}else return!1},B=function(b,c){var a;"undefined"!==typeof XMLHttpRequest?a=new XMLHttpRequest:["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"].forEach(function(b){try{a=new window.ActiveXObject(b)}catch(c){}});a.onreadystatechange=function(){4>a.readyState||200===a.status&&4===a.readyState&&c(a)};a.open("GET",b,!0);a.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"); a.setRequestHeader("Content-Type","application/json; charset=utf-8");a.send("")};m.fetch=function(b,c){c=c||{};c.script=c.script||!1;var a=this,e=0,d,f=function(d){if(++e===z(b)){for(var f in b)if(n.call(b,f))if(d&&d.response){var g=eval(d.response);g&&a.add(f,g)}else b[f].bind&&a.add(f,p(b[f].bind,r));"Function"===h(c.success)&&c.success.call(a)}},g;for(g in b)n.call(b,g)&&(y(d=b[g].path)?c.script?w(d,f):B(d,f):w(d,f));return this};r.Syringe=new u}}).call(this,module);